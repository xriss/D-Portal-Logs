<html>
  <head>
	<title>D-Portal Logs</title>
	<style>
		*		{box-sizing:border-box;}
		body	{margin:5em 0 auto; font-family:sans-serif; color:#111; position:relative; overflow-wrap:break-word;}
		.wrap	{margin:0 auto; width:960px;}
		.wrap a	{width:49%; margin:0 auto; display:inline-block; vertical-align:top;}
		
		.psa_wrap	{display:block; margin-top:3em; width:100%;}
		span.psa	{display:inline-block; vertical-align:top; width:50%}		
		
		a.log_link,
		a.stat_link	{text-decoration:none; font-size:32px; color:#444;}
		a.stat_link	{width:51%; padding-left:1em; border-left:2px solid #ccc;}
		a.git_link	{display:inline-block; margin-left:-2em; width:50%; text-decoration:none; text-align:right; color:#666;}
		a.git_link:hover,
		a:hover span	{color:#6188e2;}
		
		span		{display:block;}
		span.text	{font-size:16px; color:#666; padding:10px 0 20px 0;}
		a.log_link	span.img {background:url('./data/screenshot_logs.png')no-repeat; background-size:cover; width:90%; height:400px;}
		a.stat_link	span.img {background:url('./data/screenshot_xpath.png')no-repeat; background-size:cover; width:90%; height:400px;}
		
		h1		{color:#666; text-transform:uppercase; font-size:14px;}
		p		{padding:10px 0;}
		pre		{display:inline; margin:0; white-space:initial;}
		b		{font-weight:bold;}

		
		  
		  
		/*	Mobile-Last		*/
		@media screen and (max-width: 1024px) {
			body	{margin:0 auto; width:100%; padding-top:80px; font-size:30px;}
			.wrap, .overview	{display:block; width:100%; height:initial;}
			.nav, a.git_link, a.about_link	{height:65px;}
			td:first-of-type	{min-width:300px;}
			.nav, a.git_link, a.about_link, td:first-of-type	{font-size:30px; line-height:42px;}
			.overview span, td:nth-of-type(2)	{font-size:24px; line-height:42px;}
			h1, .stat span	{font-size:42px; line-height:64px;}
		}
		
.ct-chart svg  {
  margin:1px; 
  vertical-align:text-bottom;
}
.ct-series-a .ct-line,
.ct-series-a .ct-bar {
  stroke: red; 
  stroke-width: 1px;
}
.ct-chart-pie .ct-label {
  display:none;
}

.spark { display:inline-block; }
		  
	</style>
	<script
		src="https://code.jquery.com/jquery-3.2.1.min.js"
		integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
		crossorigin="anonymous"></script>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="https:////cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
	<script>
		var pids={}
		$.getJSON("pids.json", function(json) {
			pids=json.pids
			
			
			let tab=$(`<table style="width:100%"/>`)
			$("body").append(tab)
			
			let thead=$("<tr/>")
			tab.append(thead)
			
			thead.append("<th>History</th>")
			thead.append("<th>Activity Count</th>")
			thead.append("<th>Publisher ID</th>")
			thead.append("<th>Publisher Name</th>")

			let aa=[]
			for(let pid in pids) { pids[pid].pid=pid ; aa.push(pids[pid]) }
			aa.sort(function(a,b){return b.count-a.count})
			
			let sparkidx=0
			for(let it of aa)
			{
				sparkidx++
				let sparkname=`spark_${sparkidx}`

				let trow=$("<tr/>")
				tab.append(trow)

				trow.append(`<td id='${sparkname}' class="spark"></td>`)
				trow.append(`<td>${it.count}</td>`)
				trow.append(`<td><a href="xpath.html?pid=${it.pid}">${it.pid}</a></td>`)
				trow.append(`<td>${it.name}</td>`)
				
				$.getJSON(`pids/${it.pid}.json`,(dat,status)=>{
					
					dat=dat.xpath["/iati-activities/iati-activity/iati-identifier"].count
					
					let max=0;
					let values=[]
					for( let k of Object.keys(dat).sort() )
					{
						let v=dat[k]/1
						if(v>max){max=v}
						values.push( v )
					}

					var sparkOptions = {
						high:max,
						low:0,
						height:'32px',
						width:'256px',
						showPoint: false,
						fullWidth:true,
						chartPadding: {top: 0,right: 0,bottom: 0,left: 0},
						axisX: {showGrid: false, showLabel: false, offset: 0},
						axisY: {showGrid: false, showLabel: false, offset: 0}
					}

					new Chartist.Line(`#${sparkname}`, {series:[values]}, sparkOptions);

				})

				
			}
			
		})
	</script>
 </head>
  <body>
	<div class="wrap">
		<a class="log_link" href="./logs.html">
			<span class="title">Logs</span>
			<span class="text">Statistics &amp; graphs of the D-Portal database.</span>
			<span class="img"></span>
		</a><a class="stat_link" href="./xpath.html">
			<span class="title">Xpath Stats</span>
			<span class="text">Statistics &amp; graphs of IATI elements in the database.</span>
			<span class="img"></span>
		</a>
		<div class="psa_wrap">
			<span class="psa">Please be aware that these pages take awhile to load.</span><a class="git_link" href="https://github.com/xriss/D-Portal-Logs">Source on Github</a>
		</div>
	</div>
  </body>
</html>
