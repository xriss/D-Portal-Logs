<html>
  <head>
	<title>D-Portal Logs</title>
	<style>
		
		  body	{padding:30px; margin:0 auto; color:#111; word-break:break-word; position:relative;}
		  div	{width:400px; height:200px; margin:0 auto; display:inline-block; vertical-align:top; padding:20px;}
		  h1	{font-family:monospace; text-transform:uppercase; font-size:1.5em;}
		  
		  a.git_link		{display:block; position:absolute; top:0; right:0; padding:10px 20px; background-color:#444; color:#fff; text-decoration:none; font-family:sans-serif; font-size:14px;}
		  a.git_link:hover	{background-color:#555;}
		  
		  .wrap	{display:inline-block; vertical-align:top; width:20%; height:initial; margin-bottom:20px;}
		  .wrap div:first-of-type span	{border-top:1px solid #ccc;}
		  .wrap div:last-child span		{border-bottom:1px solid #ccc;}
		  
		  .chart_wrap	{display:block; width:initial; height:initial; margin-top:20px;}

		  .stat	{display:table; table-layout:fixed; width:100%; height:initial; text-transform:capitalize; font-family:sans-serif; font-size:16px; border:0px solid #ccc; border-bottom:0; border-right:0; padding:0;}

		  .stat span				{display:table-cell; padding:10px 20px; border-right:1px solid #ccc;}
		  .stat span:first-of-type	{width:40%; border-left:1px solid #ccc;}
		  .stat:nth-of-type(even)	{background-color:#f7f7f7;}
		  
	</style>
	<script
		src="https://code.jquery.com/jquery-3.2.1.min.js"
		integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
		crossorigin="anonymous"></script>
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
 </head>
  <body>
	<script>
		
var addchart=function(data,opts){
 
	var div=$('<div> <canvas></canvas> </div>')
	$("body").append(div)
	var ctx=div.children(":first")[0].getContext("2d");

	var dl=[]
	var dv=[]
	var idx=0
	for(var n in data){
		dl[idx]=(new Date(Number(n)*8.64e7)).toLocaleDateString()
		dv[idx]=data[n]
		idx++
	}
	
var config = {
	type: 'line',
	data: {
		labels: dl,
		datasets: [{
			label: opts.name || "Filled",
			backgroundColor: opts.color || "#f44",
			borderColor: opts.color || "#f44",
			data: dv,
			fill: true,
		}]
	},
	options: {
		responsive: true,
		title:{
			display:opts.title && true || false,
			text:opts.title || 'Chart.js Line Chart',
			fontSize:14
		},
		tooltips: {
			mode: 'index',
			intersect: false,
		},
		hover: {
			mode: 'nearest',
			intersect: true
		},
		scales: {
			xAxes: [{
				display: true,
				scaleLabel: {
					display: true,
					labelString: 'Day'
				}
			}],
			yAxes: [{
				display: true,
				scaleLabel: {
					display: true,
					labelString: 'Amount'
				}
			}]
		}
	}
};

   return new Chart(ctx, config);
};

$.getJSON("stats.json", function(json) {


// Snapshots

var div=$('<div class="wrap"><h1> SNAPSHOT </h1></div>')
$("body").append(div)

for(var n in json.count)
{
	var h=0;	// h = highest
	
	for(var q in json.count[n])
	{
		if (q > h)
		{
			h = q;
		}
	}
	
	var number = Number(json.count[n][h]);	
	var div2=$('<div class="stat"><span>'+(number.toLocaleString())+'</span><span>'+n+'</span></div>')
	div.append(div2)
}

for(var n in json.distinct)
{
	var div=$('<div class="wrap"><h1> '+n+' </h1></div>')
	$("body").append(div)
	
	for(var t in json.distinct[n])
	{
		var h=0;	// h = highest
		
		for(var q in json.distinct[n][t])
		{
			if (q > h)
			{
				h = q;
			}
		}
		
		var number = Number(json.distinct[n][t][h]);	
		var div2=$('<div class="stat"><span>'+(number.toLocaleString())+'</span><span>'+t+'</span></div>')
		div.append(div2)
	}
}


// Charts

var div=$('<div class="chart_wrap"><h1> DATABASE </h1></div>')
$("body").append(div)

for(var n in json.count)
{
	window["chartjs_"+n]=
        addchart(json.count[n],
            {title:"Total "+n+" table entries recorded in the database",name:n,color:"#000"});
}


for(var n in json.distinct)
{
	var div=$('<div class="chart_wrap"><h1> '+n+' TABLE </h1></div>')
	$("body").append(div)

   for(var t in json.distinct[n])
	{
		window["chartjs_"+n+"_"+t]=
            addchart(json.distinct[n][t],
                {title:"Distinct "+t+" values recorded in "+n+" ",name:n+"."+t,color:"#444"});
	}

}

});

	</script>
	<a class="git_link" href="https://github.com/xriss/D-Portal-Logs">Source code for D-Portal-Logs is on Github</a>
  </body>
</html>
